<!--/* CJCJ Campaign Form Component */-->
<p data-sly-test.edit="${wcmmode.edit}" data-emptytext="Configure CJCJ Campaign Form Component" class="cq-placeholder"></p>

<script>
console.log('CJCJ Campaign Form: Inline script test - JavaScript is working');

function handleFormSubmit(event) {
    console.log('CJCJ Campaign Form: Form submit event triggered');
    
    // Get form elements
    const form = document.getElementById('cjcj-campaign-form');
    const submitBtn = document.getElementById('campaign-submit-btn');
    const submitText = submitBtn.querySelector('.campaign__submit-text');
    const submitLoading = submitBtn.querySelector('.campaign__submit-loading');
    const successMessage = document.querySelector('.campaign__message--success');
    const errorMessage = document.querySelector('.campaign__message--error');
    const successText = successMessage.querySelector('.campaign__message-text');
    const errorText = errorMessage.querySelector('.campaign__message-text');
    
    // Hide any previous messages
    hideMessages();
    
    // Set loading state
    setLoading(true);
    
    // Collect form data
    const formData = new FormData(form);
    const submitUrl = '/bin/cjcj-campaign-form-submit.json';
    
    console.log('=== CJCJ CAMPAIGN FORM SUBMISSION ===');
    console.log('CJCJ Campaign Form: Form data collected');
    console.log('CJCJ Campaign Form: Submitting to:', submitUrl);
    console.log('CJCJ Campaign Form: Form data entries:');
    for (let [key, value] of formData.entries()) {
        console.log('  - ' + key + ':', value);
    }
    
    // Send AJAX request
    console.log('CJCJ Campaign Form: Sending AJAX request...');
    fetch(submitUrl, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => {
        console.log('=== CJCJ CAMPAIGN FORM API CALL ===');
        console.log('CJCJ Campaign Form: Response received, status:', response.status);
        console.log('CJCJ Campaign Form: API Endpoint:', submitUrl);
        console.log('CJCJ Campaign Form: HTTP Status:', response.status, response.statusText);
        
        if (!response.ok) {
            console.error('❌ CJCJ Campaign Form: API Response FAILED (HTTP ' + response.status + ')');
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        console.log('CJCJ Campaign Form: Response data:', data);
        console.log('CJCJ Campaign Form: Full API Response:', JSON.stringify(data, null, 2));
        setLoading(false);
        
        if (data.success) {
            console.log('✅ CJCJ Campaign Form: API Response SUCCESS');
            console.log('CJCJ Campaign Form: Success message:', data.message);
            window.adobeDataLayer = window.adobeDataLayer || [];
            window.adobeDataLayer.push({
                "event": "formSubmit", 
                "formSubmit": {
                    "Name": formData.get('yourName') || '',
                    "email": formData.get('email') || '',
                    "phone": formData.get('phone') || '',
                    "Company": formData.get('companyField') || '',
                    "City":formData.get('city') || '',
                    "What are you looking for": formData.get('message') || ''
                }
            });
            showSuccess(data.message || 'Form submitted successfully!');
            form.reset(); // Clear the form
        } else {
            console.log('❌ CJCJ Campaign Form: API Response FAILED');
            console.log('CJCJ Campaign Form: Error message:', data.message);
            showError(data.message || 'Failed to submit form. Please try again.');
        }
    })
    .catch(error => {
        setLoading(false);
        console.error('CJCJ Campaign Form: Form submission error:', error);
        showError('An error occurred while submitting the form. Please try again.');
    });
    
    function hideMessages() {
        successMessage.style.display = 'none';
        errorMessage.style.display = 'none';
    }
    
    function showSuccess(message) {
        hideMessages();
        successText.textContent = message;
        successMessage.style.display = 'block';
        successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    function showError(message) {
        hideMessages();
        errorText.textContent = message;
        errorMessage.style.display = 'block';
        errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    function setLoading(loading) {
        if (loading) {
            submitBtn.disabled = true;
            submitText.style.display = 'none';
            submitLoading.style.display = 'inline';
        } else {
            submitBtn.disabled = false;
            submitText.style.display = 'inline';
            submitLoading.style.display = 'none';
        }
    }
}
</script>

<div class="campaign" data-sly-use.model="com.mysite.core.models.CjcjCampaignFormModel">
    <div class="campaign__container">
        <div class="campaign__content">
            <div class="campaign__header">
                <div class="campaign__logo">
                    <img src="${model.decorativeImage || '/aem-cloud/ui.frontend/dist/clientlib-site/images/form-logo.png'}" 
                         alt="Logo" 
                         class="campaign__logo-image"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="campaign__logo-fallback" style="display:none;">
                        <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
                            <rect width="120" height="120" fill="#F0F0F0"/>
                            <text x="60" y="60" text-anchor="middle" dy=".3em" fill="#999">Logo</text>
                        </svg>
                    </div>
                </div>
                <div class="campaign__text">
                    <h2 class="campaign__title" data-sly-test="${model.title}">${model.title}</h2>
                    <p class="campaign__description" data-sly-test="${model.description}">${model.description}</p>
                </div>
            </div>
            <div class="campaign__form">
                <!-- Success/Error Message Display -->
                <div class="campaign__message campaign__message--success" style="display: none;">
                    <div class="campaign__message-content">
                        <span class="campaign__message-icon">✓</span>
                        <span class="campaign__message-text"></span>
                    </div>
                </div>
                
                <div class="campaign__message campaign__message--error" style="display: none;">
                    <div class="campaign__message-content">
                        <span class="campaign__message-icon">✗</span>
                        <span class="campaign__message-text"></span>
                    </div>
                </div>
                
                <form class="campaign__form-container" 
                      id="cjcj-campaign-form" 
                      method="POST"
                      onsubmit="handleFormSubmit(event); return false;">
                    <div class="campaign__form-group">
                        <input type="text" 
                               name="yourName" 
                               placeholder="Your Name" 
                               class="campaign__input" 
                               required />
                    </div>
                    <div class="campaign__form-group">
                        <input type="email" 
                               name="email" 
                               placeholder="Email" 
                               class="campaign__input" 
                               required />
                    </div>
                    <div class="campaign__form-group">
                        <input type="tel" 
                               name="phone" 
                               placeholder="Phone" 
                               class="campaign__input" 
                               required />
                    </div>
                    <div class="campaign__form-group">
                        <select name="companyField" class="campaign__select" required>
                            <option value="" disabled selected hidden>Company / Field of work</option>
                            <option value="technology">Technology</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="finance">Finance</option>
                            <option value="education">Education</option>
                            <option value="retail">Retail</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="campaign__form-group">
                        <input type="text" 
                               name="city" 
                               placeholder="City" 
                               class="campaign__input" 
                               required />
                    </div>
                    <div class="campaign__form-group">
                        <textarea name="message" 
                                  placeholder="What are you looking for?" 
                                  class="campaign__textarea" 
                                  rows="4" 
                                  required></textarea>
                    </div>
                    <div class="campaign__form-group">
                        <button type="submit" class="campaign__submit" id="campaign-submit-btn">
                            <span class="campaign__submit-text">${model.submitButtonText || 'keep in touch'}</span>
                            <span class="campaign__submit-loading" style="display: none;">Submitting...</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="campaign__background" data-sly-test="${model.backgroundImage}">
        <img src="${model.backgroundImage}" 
             alt="Background" 
             class="campaign__background-image" />
    </div>
</div>